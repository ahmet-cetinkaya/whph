name: "Initialize Submodules"
description: "Initializes required submodules for the project"

runs:
  using: "composite"
  steps:
    - name: Initialize acore submodule
      shell: bash
      run: |
        echo "Initializing acore submodule..."

        # Clean any potential submodule issues first
        git submodule sync || echo "Submodule sync not needed"

        # Initialize the acore submodule with explicit handling for Windows
        if git submodule update --init --recursive packages/acore-flutter packages/acore-scripts; then
          echo "âœ… ACore submodules initialized successfully"
        else
          echo "âŒ Failed to initialize acore submodules"
          echo "ğŸ” Debugging submodule status:"
          git submodule status || echo "Could not get submodule status"
          git ls-files --stage | grep 160000 || echo "No submodules found in index"

          # Try alternative initialization for Windows
          echo "ğŸ”„ Trying alternative initialization..."
          git submodule init
          git submodule update --recursive packages/acore-flutter packages/acore-scripts || {
            echo "âŒ Alternative initialization also failed"
            exit 1
          }
        fi

        # Verify the submodule was initialized correctly
        if [[ -d "packages/acore-flutter" && -f "packages/acore-flutter/pubspec.yaml" ]]; then
          echo "âœ… acore-flutter verification passed"
          echo "ğŸ“ Submodule directory: packages/acore-flutter"
          echo "ğŸ“„ pubspec.yaml found: $(ls -la packages/acore-flutter/pubspec.yaml)"
        else
          echo "âŒ acore-flutter verification failed"
          echo "ğŸ“ Submodule directory contents:"
          ls -la packages/acore-flutter/ 2>/dev/null || echo "Directory not found"
          exit 1
        fi

        if [[ -d "packages/acore-scripts" ]]; then
          echo "âœ… acore-scripts verification passed"
          echo "ğŸ“ Submodule directory: packages/acore-scripts"
        else
           echo "âŒ acore-scripts verification failed"
           exit 1
        fi
